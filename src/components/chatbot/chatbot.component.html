<div
  class="relative flex flex-col h-full w-full max-w-4xl mx-auto bg-slate-800/25"
>
  <!-- Header -->
  <app-header
    [(showProfile)]="showProfile"
    [(showSettings)]="showSettings"
    (quickAction)="sendQuickAction($event)"
  ></app-header>

  <!-- Messages -->
  <div
    #chatContainer
    (scroll)="onChatScroll($event)"
    class="flex-1 space-y-4 overflow-y-auto min-w-1/2 chat-container relative pb-20 bg-slate-900/50 overflow-x-hidden"
  >
    @for (message of messages(); track message.id) {
    <app-message-item
      [message]="message"
      [workouts]="workouts()"
      [groupedWorkoutsByWeek]="groupedWorkoutsByWeek()"
      [getFriendlyDateHeader]="getFriendlyDateHeader"
      (quickAction)="sendQuickAction($event)"
      (deleteWorkout)="deleteWorkout($event)"
      (toggleWeek)="toggleWeek($event)"
    ></app-message-item>
    }
  </div>

  <!-- Input Form -->
  <footer class="absolute bottom-0 left-0 right-0 p-2">
    <app-chat-input
      [(userInput)]="userInput"
      (sendMessage)="sendMessage()"
      [isLoading]="isLoading()"
    ></app-chat-input>

    <!-- Scroll to bottom button -->
    @if (showScrollButton()) {
    <button
      (click)="smoothScrollToBottom()"
      class="absolute bottom-20 right-4 z-50 bg-emerald-600/50 backdrop-blur-sm rounded-full w-10 h-10 flex items-center justify-center shadow-lg hover:bg-emerald-600 transition-all animate-fade-in"
      title="Ir para mensagens recentes"
    >
      <span class="text-2xl">⬇️</span>
    </button>
    }
  </footer>

  <!-- Profile Modal -->
  @if (showProfile()) {
  <app-user [(showProfile)]="showProfile"></app-user>
  }

  <!-- Settings Modal -->
  @if (showSettings()) {
  <app-settings
    [(showSettings)]="showSettings"
    (salvoComSucesso)="this.addMessage('model', 'text', $event)"
  ></app-settings>
  }

  <input
    type="file"
    #importFileInput
    class="hidden"
    (change)="importData($event)"
    accept=".json"
  />
</div>
